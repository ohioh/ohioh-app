<!DOCTYPE HTML>
<html lang="de">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>OHIOH-Research</title>
    <link rel="stylesheet" type="text/css" href="/style/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="/style/style.css">
    <link
        href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900|Roboto:300,300i,400,400i,500,500i,700,700i,900,900i&amp;display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/fonts/css/fontawesome-all.min.css">
    <link rel="manifest" href="_manifest.json" data-pwa-version="1.0.1">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/Icon-apple-180.png">

    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap/css/bootstrap4-toggle.min.css">

</head>


<body class="theme-light" data-highlight="OHIOH">

    <div id="preloader">
        <div class="spinner-border color-highlight" role="status"></div>
    </div>

    <div id="page">

        <header>
            <!-- header and footer bar go here-->
            <div class="header header-fixed header-auto-show header-logo-app">
                <a href="index.html" class="header-title">OHIOH-Research-APP</a>
                <a href="#" data-menu="menu-main" class="header-icon header-icon-1"><i class="fas fa-bars"></i></a>
                <a href="#" data-toggle-theme class="header-icon header-icon-2 show-on-theme-dark"><i
                        class="fas fa-sun"></i></a>
                <a href="#" data-toggle-theme class="header-icon header-icon-2 show-on-theme-light"><i
                        class="fas fa-moon"></i></a>
                <a href="#" data-menu="menu-highlights" class="header-icon header-icon-3"><i
                        class="fas fa-brush"></i></a>
            </div>
        </header>

        <footer>
            <div id="footer-bar" class="footer-bar-5">
                <a href="index-features.html"><i data-feather="heart" data-feather-line="1" data-feather-size="21"
                        data-feather-color="ohioh" data-feather-bg="red2-fade-light"></i><span>Features</span></a>
                <a href="index-research.html"><i data-feather="bluetooth" data-feather-line="1" data-feather-size="21"
                        data-feather-color="ohioh" data-feather-bg="green1-fade-light"></i><span>Research</span></a>
                <a href="index.html" class="active-nav"><i data-feather="home" data-feather-line="1"
                        data-feather-size="21" data-feather-color="ohioh"
                        data-feather-bg="blue2-fade-light"></i><span>Dashboard</span></a>
                <a href="index-QR.html"><i data-feather="camera" data-feather-line="1" data-feather-size="21"
                        data-feather-color="ohioh" data-feather-bg="brown1-fade-light"></i><span>QR-Infos</span></a>

            </div>
        </footer>

        <section>
            <div class="page-content">
                <header>
                    <div class="page-title page-title-large">
                        <h2 data-username="@OHIOH-App" class="greeting-text"></h2>
                        <a href="#" data-menu="menu-main" class="bg-fade-gray1-dark shadow-xl preload-img"
                            data-src="/icons/Icon-48.png"></a>
                    </div>

                    <div class="card header-card shape-rounded" data-card-height="210">
                        <div class="card-overlay bg-highlight opacity-95"></div>
                        <div class="card-overlay dark-mode-tint"></div>
                        <div class="card-bg preload-img" data-src="/icons/Icon-48.png"></div>
                    </div>


                    <!-- Homepage Slider-->
                    <div class="single-slider-boxed text-center owl-no-dots owl-carousel">
                        <div class="card rounded-l shadow-l">
                            <div data-card-height="250" class="card bg-28 rounded-m shadow-l">
                                <div class="card-bottom text-center mb-4">
                                    <h2 class="color-white text-uppercase font-900">OHIOH-Research-APP</h2>
                                    <p class="boxed-text-xl">
                                        Wir forschen an der Fachhochschule Kiel an der Tracing-Sensorik.
                                    </p>
                                </div>
                                <div class="card-overlay bg-gradient"></div>
                                <div class="card-bg owl-lazy" data-src="images/pictures/pic_sign.jpg"></div>
                            </div>
                            <a href="https://www.fh-kiel.de/startseite/" target="_blank"
                                class="under-slider-btn btn btn-s btn-center-xs text-uppercase font-900 bg-green1-dark rounded-s">page</a>
                            <button class="btn btn-primary" type="button" data-toggle="collapse"
                                data-target="#collapse1" aria-expanded="false" aria-controls="collapse1">
                                more<a href="https://www.fh-kiel.de/startseite/" target="_blank"></a>
                            </button>
                        </div>


                        <div class="card rounded-l shadow-l">
                            <div data-card-height="250" class="card bg-28 rounded-m shadow-l">
                                <div class="card-bottom text-center mb-4">
                                    <h2 class="color-white text-uppercase font-900">Our Health In Our Hands</h2>
                                    <p class="boxed-text-xl">
                                        The OHIOH-Research-APP: hohe Genauigkeit, wenig Verbrauch und alle Einstellungen
                                        selbst in der Hand!
                                    </p>
                                </div>
                                <div class="card-overlay bg-gradient"></div>
                                <div class="card-bg owl-lazy" data-src="images/pictures/pic_roof.jpg"></div>
                            </div>
                            <a href="https://www.fh-kiel.de/startseite/" target="_blank"
                                class="under-slider-btn btn btn-s btn-center-xs text-uppercase font-900 bg-green1-dark rounded-s">more</a>
                            <button class="btn btn-primary" type="button" data-toggle="collapse"
                                data-target="#collapse2" aria-expanded="false" aria-controls="collapse2">
                                more<a href="https://www.fh-kiel.de/startseite/" target="_blank"></a>
                            </button>
                        </div>


                        <div class="card rounded-l shadow-l">
                            <div data-card-height="250" class="card bg-28 rounded-m shadow-l">
                                <div class="card-bottom text-center mb-4">
                                    <h2 class="color-white text-uppercase font-900">Forschungsbasiert</h2>
                                    <p class="boxed-text-xl">
                                        Ehrenamtlich und täglich im Einsatz #FightCovid19
                                    </p>
                                </div>
                                <div class="card-overlay bg-gradient"></div>
                                <div class="card-bg owl-lazy" data-src="images/icons/ohioh.png"></div>
                            </div>
                            <a href="https://ohioh.de" target="_blank"
                                class="under-slider-btn btn btn-s btn-center-xs text-uppercase font-900 bg-green1-dark rounded-s">more</a>
                            <button class="btn btn-primary" type="button" data-toggle="collapse"
                                data-target="#collapse3" aria-expanded="false" aria-controls="collapse3">
                                more<a href="https://www.fh-kiel.de/startseite/" target="_blank"></a>
                            </button>
                        </div>


                        <div class="card rounded-l shadow-l">
                            <div data-card-height="250" class="card bg-28 rounded-m shadow-l">
                                <div class="card-bottom text-center mb-4">
                                    <h2 class="color-white text-uppercase font-900">Part of the Linux Foundation Public
                                        Health
                                    </h2>
                                    <p class="boxed-text-xl">
                                        Der Code ist von Github bis zur App nachvollziehbar. 100% Open Source
                                    </p>
                                </div>
                                <div class="card-overlay bg-gradient"></div>
                                <div class="card-bg owl-lazy" data-src="images/icons/linuxfoundation.png"></div>
                            </div>
                            <a href="https://www.lfph.io//" target="_blank"
                                class="under-slider-btn btn btn-s btn-center-xs text-uppercase font-900 bg-green1-dark rounded-s">page</a>
                            <button class="btn btn-primary" type="button" data-toggle="collapse"
                                data-target="#collapse4" aria-expanded="false" aria-controls="collapse4">
                                more<a href="https://www.fh-kiel.de/startseite/" target="_blank"></a>
                            </button>
                        </div>
                    </div>
                    <div class="collapse" id="collapse1">
                        <div class="card card-body">
                            Erfahre mehr über die App und die Arbeit von OHIOH auf unserem Blog<br>
                            <a class="h3" href="https://ohioh.de/blog/">Blog</a>
                        </div>
                    </div>
                    <div class="collapse" id="collapse2">
                        <div class="card card-body">
                            Erfahre mehr über die App und die Arbeit von OHIOH auf unserem Blog<br>
                            <a class="h3" href="https://ohioh.de/blog/">Blog</a>
                        </div>
                    </div>
                    <div class="collapse" id="collapse3">
                        <div class="card card-body">
                            Erfahre mehr über die App und die Arbeit von OHIOH auf unserem Blog<br>
                            <a class="h3" href="https://ohioh.de/blog/">Blog</a>
                        </div>
                    </div>
                    <div class="collapse" id="collapse4">
                        <div class="card card-body">
                            Erfahre mehr über die App und die Arbeit von OHIOH auf unserem Blog<br>
                            <a class="h3" href="https://ohioh.de/blog/">Blog</a>
                        </div>
                    </div>
                </header>

                <article>
                    <h1>Einstellungen</h1>
                    <div class="card card-style mt-4 shadow-l" data-card-height="280">
                        <div class="row">
                            <div class="col-6">
                                Datenerhebung
                            </div>
                            <div class="col-6">
                                Scan Einstellungen
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-5">
                                GPS
                            </div>
                            <div class="col-1">
                                <input type="checkbox" id="GPS" >
                            </div>
                            <div class="col-4">
                                Zeit
                            </div>
                            <div class="col-2">
                                <input type="checkbox" id="Time" >
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-5">
                                Private Daten spenden
                            </div>
                            <div class="col-1">
                                <input type="checkbox" id="privateData" >
                            </div>
                            <div class="col-4">
                                Intervall Scan
                            </div>
                            <div class="col-2">
                                <input type="checkbox" id="Interval" >
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-5">
                                Personendaten ergänzen
                            </div>
                            <div class="col-1">
                                <input type="checkbox" id="personalData" >
                            </div>
                            <div class="col-5">
                            </div>
                            <div class="col-1">

                            </div>
                        </div>
                    </div>
                </article>
                <article>
                    <h1>Scanner</h1>
                    <div class="card card-style mt-4 shadow-l " data-card-height="350">
                      
                            <div class="row form-row align-items-center">
                                <div class="col divider-margins">
                                    <label class="" for="Dauer">Scandauer</label>
                                    <select class="" id="Dauer">
                                        <option selected>wähle...</option>
                                        <option value="0">1 Sekunde</option>
                                        <option value="1">5 Sekunden</option>
                                        <option value="2">10 Sekunden</option>
                                        <option value="3">30 Sekunden</option>
                                    </select>
                                </div>
                                <div class="col divider-margins">
                                    <label class="" for="Interval">Scanabstand</label>
                                    <select class="" id="Interval">
                                        <option selected>wähle...</option>
                                        <option value="1">permanent</option>
                                        <option value="1">30 Sekunden</option>
                                        <option value="2">60 Sekunden</option>
                                        <option value="3">2 Minuten</option>
                                    </select>
                                </div>
                            </div>

                            <div class="row  mx-autos">
                                <div class="col">
                                    <input type="checkbox" checked data-toggle="toggle" data-on="aktiv"
                                        data-off="deaktiviert" data-onstyle="success" data-offstyle="danger"
                                        id="ResearchSafe">
                                    <label class=" mx-autos" for="customControlAutosizing">Eingaben
                                        speichern
                                    </label>
                                </div>
                                <div class="col">
                                    <button type="submit" class="btn btn-primary">Speichern</button>
                                </div>
                            </div>

                            <div class="row mx-autos align-items-center">
                                <div class="col-6 ">
                                    <form>
  
  <button>Scan for Bluetooth Advertisements</button>
</form>
                                </div>
                                <div class="col-6">
                                    <button type="button" class="btn btn-outline-danger">Löschen</button>
                                </div>
                            </div>

                            <div class="row mx-auto">
                                <div class="col">
                                    <button type="button" class="btn btn-secondary btn-lg btn-block">Senden</button>
                                </div>
                            </div>


                       
                    </div>
                </article>

                <article>
                    <div class="card card-style mt-4 shadow-l" data-card-height="340">
                        <p>Logger</p>
                    </div>
                </article>
            </div>
        </section>
    </div>
<script>
    function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(';');
  for(var i = 0; i < ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}
   // Add a global error event listener early on in the page load, to help ensure that browsers
      // which don't support specific functionality still end up displaying a meaningful message.
      window.addEventListener('error', function(error) {
        if (ChromeSamples && ChromeSamples.setStatus) {
          console.error(error);
          ChromeSamples.setStatus(error.message + ' (Your browser may not support this feature.)');
          error.preventDefault();
        }
      });
      
  if('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
  }

  window.addEventListener('DOMContentLoaded', function() {
    const searchParams = new URL(location).searchParams;
    const inputs = Array.from(document.querySelectorAll('input[id]'));

    inputs.forEach(input => {
      if (searchParams.has(input.id)) {
        if (input.type == 'checkbox') {
          input.checked = searchParams.get(input.id);
        } else {
          input.value = searchParams.get(input.id);
          input.blur();
        }
      }
      if (input.type == 'checkbox') {
        input.addEventListener('change', function(event) {
          const newSearchParams = new URL(location).searchParams;
          if (event.target.checked) {
            newSearchParams.set(input.id, event.target.checked);
          } else {
            newSearchParams.delete(input.id);
          }
          history.replaceState({}, '', Array.from(newSearchParams).length ?
              location.pathname + '?' + newSearchParams : location.pathname);
        });
      } else {
        input.addEventListener('input', function(event) {
          const newSearchParams = new URL(location).searchParams;
          if (event.target.value) {
            newSearchParams.set(input.id, event.target.value);
          } else {
            newSearchParams.delete(input.id);
          }
          history.replaceState({}, '', Array.from(newSearchParams).length ?
              location.pathname + '?' + newSearchParams : location.pathname);
        });
      }
    });
  });

    var ChromeSamples = {
    log: function() {
      var line = Array.prototype.slice.call(arguments).map(function(argument) {
        return typeof argument === 'string' ? argument : JSON.stringify(argument);
      }).join(' ');

      document.querySelector('#log').innerHTML += line + '\n';
    },

    clearLog: function() {
      document.querySelector('#log').textContent = '';
    },

    setStatus: function(status) {
      document.querySelector('#status').textContent = status;
    },

    setContent: function(newContent) {
      var content = document.querySelector('#content');
      while(content.hasChildNodes()) {
        content.removeChild(content.lastChild);
      }
      content.appendChild(newContent);
    }
  };

  if (/Chrome\/(\d+\.\d+.\d+.\d+)/.test(navigator.userAgent)){
    // Let's log a warning if the sample is not supposed to execute on this
    // version of Chrome.
    if (79 > parseInt(RegExp.$1)) {
      ChromeSamples.setStatus('Warning! Keep in mind this sample has been tested with Chrome ' + 79 + '.');
    }
  }

      
      async function onButtonClick() {
	        function success(position) {
    const latitude  = position.coords.latitude;
    const longitude = position.coords.longitude;

log('Latitude : '+  latitude );
	log('Longitude : '+  longitude );		
  }

  function error() {
    status.textContent = 'Unable to retrieve your location';
  }

  if(!navigator.geolocation) {
    log( 'Geolocation is not supported by your browser');
  } else {
    log( 'Locating…');
    navigator.geolocation.getCurrentPosition(success, error);
  }
	      
	      var flag = 1;
  scanon();
function scanon() {
  setTimeout(function(){
  //  log('Scan off');
  flag=0;
  scanoff();
  
  }, 10000);
}

function scanoff() {
  setTimeout(function(){
 // log('Scan start');
  
  flag = 1;
  scanon();
  
  }, 1000);
}
  let options = {};
  
    options.acceptAllAdvertisements = true;
  

  try {
  //  log('Requesting Bluetooth Scan with options: ' + JSON.stringify(options));
    const scan = await navigator.bluetooth.requestLEScan(options);

    log('Scan started ');
   // log(' acceptAllAdvertisements: ' + scan.acceptAllAdvertisements);
  //  log(' active: ' + scan.active);
   // log(' keepRepeatedDevices: ' + scan.keepRepeatedDevices);
    //log(' filters: ' + JSON.stringify(scan.filters));
var devices = [];
    navigator.bluetooth.addEventListener('advertisementreceived', event => {

        
 
        if ( event.device.name != null && flag == 1)
      {
	    
	      // log('Advertisement received.');
        function checkAdult(device) {
        //  log('||' + typeof device+'|'+ typeof event.uuids+"||");
            return device+" " == event.uuids+" ";
          }
          if(devices.find(checkAdult))
{
//log("hhhhhhhhhhhhh");
}
      
else{
//log("xxxxxxx");
   devices.push(event.uuids);
    if(1)
        {
        


        
         
          VALUE = JSON.stringify({
          
          "email": getCookie('email'),
      "uuid": event.uuids+" ",
"rssi": event.rssi+" ",
"devicename": event.device.name,
            "txpower" : event.txPower+" "
          });
    console.log(VALUE);

    const myHeaders = new Headers();
    myHeaders.append('Content-Type', 'application/json');

    fetch('https://ohioh.app:8442/api/users', {
        method: 'POST',
        headers: myHeaders,
        mode: 'cors',
        cache: 'default',
        body: VALUE
    })
    .then(data => data.json())
    .then(data =>  { console.log(data)
                  // window.location.href = "https://gui--festive-ardinghelli-674e56.netlify.app/index.html";
                 //   alert("Congrats you are successfully logged in");
                   }) 
    .catch((err) => {
        console.error(err);
    })
          
         log('Device received.');
      log('  Device Name: ' +'<i>'+ event.device.name+'</i>');
      log('  Device ID: '+'<i>' + event.device.id+'</i>');
      log('  RSSI: ' + event.rssi);
      log('  TX Power: '+ + event.txPower);
          
      log('  UUIDs: '+'<i>' + event.uuids+'</i>');
           log('  Time: '+'<i>'  +  new Date(new Date().getTime() + 4*60*60*1000).toLocaleTimeString()+'</i>');
           log('......................................')
      event.manufacturerData.forEach((valueDataView, key) => {
        logDataView('Manufacturer', key, valueDataView);
      });
      event.serviceData.forEach((valueDataView, key) => {
        logDataView('Service', key, valueDataView);
      });
     
      }
}
    }
     
    });

    setTimeout(stopScan, 10000);
    function stopScan() {
     // log('Stopping scan...');
     // scan.stop();
     
     // log('Stopped.  scan.active = ' + scan.active);
	 //    scan = await navigator.bluetooth.requestLEScan(options);
	 //    log('Stopped.  scan.active = ' + scan.active);
    }
  } catch(error)  {
    log('Argh! ' + error);
  }
}

/* Utils */

const logDataView = (labelOfDataSource, key, valueDataView) => {
  const hexString = [...new Uint8Array(valueDataView.buffer)].map(b => {
    return b.toString(16).padStart(2, '0');
  }).join(' ');
  const textDecoder = new TextDecoder('ascii');
  const asciiString = textDecoder.decode(valueDataView.buffer);
  log(`  ${labelOfDataSource} Data: ` + key +
      '\n    (Hex) ' + hexString +
      '\n    (ASCII) ' + asciiString);
};

  document.querySelector('form').addEventListener('submit', function(event) {
    event.stopPropagation();
    event.preventDefault();

    if (isWebBluetoothEnabled()) {
      ChromeSamples.clearLog();
      onButtonClick();
    }
  });

  log = ChromeSamples.log;

  function isWebBluetoothEnabled() {
    if (navigator.bluetooth) {
      return true;
    } else {
      ChromeSamples.setStatus('Web Bluetooth API is not available.\n' +
          'Please make sure the "Experimental Web Platform features" flag is enabled.');
      return false;
    }
  }

      /* jshint ignore:start */
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-53563471-1', 'auto');
      ga('send', 'pageview');
      /* jshint ignore:end */
    
    </script>
    <script rel="script" type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
    <script rel="script" type="text/javascript" src="bootstrap/js/jquery-3.5.1.min.js"></script>
    <script rel="script" type="text/javascript" src="bootstrap/js/popper.min.js"></script>
    <script rel="script" type="text/javascript" src="bootstrap/js/bootstrap4-toggle.min.js"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/custom.js"></script>
    <script type="text/javascript" src="js/charts.js"></script>
    <script type="text/javascript" src="index.js"></script>

</body>

</html>
